apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: costq-fastapi
  namespace: costq-fastapi
  labels:
    environment: production
  annotations:
    # ALB Ingress Controller annotations
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: instance
    alb.ingress.kubernetes.io/ip-address-type: ipv4

    # SSL/TLS Configuration
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-northeast-1:000451883532:certificate/7c3c4a7a-4d0a-436a-93da-a5b929787b22
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: "443"
    alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS13-1-2-2021-06

    # Network Configuration
    alb.ingress.kubernetes.io/subnets: subnet-02b214ac19f13a93d,subnet-01332c4562508b627,subnet-0589b1227fa6a91c5
    alb.ingress.kubernetes.io/security-groups: sg-015305d6a7eafe6d2

    # Health Check Configuration
    alb.ingress.kubernetes.io/healthcheck-protocol: HTTP
    alb.ingress.kubernetes.io/healthcheck-path: /health
    alb.ingress.kubernetes.io/healthcheck-port: traffic-port
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: "30"
    alb.ingress.kubernetes.io/healthcheck-timeout-seconds: "5"
    alb.ingress.kubernetes.io/healthy-threshold-count: "5"
    alb.ingress.kubernetes.io/unhealthy-threshold-count: "5"
    alb.ingress.kubernetes.io/success-codes: "200"

    # Backend Configuration
    alb.ingress.kubernetes.io/backend-protocol: HTTP

    # Target Group Configuration
    alb.ingress.kubernetes.io/target-group-attributes: deregistration_delay.timeout_seconds=30

    # Load Balancer Attributes
    alb.ingress.kubernetes.io/load-balancer-attributes: deletion_protection.enabled=false

    # Tags
    alb.ingress.kubernetes.io/tags: Owner=liyuguang,project=costq
spec:
  rules:
  - host: costq.cloudminos.jp
    http:
      paths:
      - path: /*
        pathType: ImplementationSpecific
        backend:
          service:
            name: costq-fastapi
            port:
              number: 80
